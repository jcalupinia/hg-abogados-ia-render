services:
  - type: web
    name: hg-abogados-ia
    env: python
    region: oregon
    plan: free
    autoDeploy: true

    buildCommand: |
      echo "üöÄ Iniciando instalaci√≥n del entorno H&G Abogados IA..."
      pip install --upgrade pip
      pip install -r requirements.txt
      # Instalaci√≥n de Playwright y dependencias del navegador
      playwright install --with-deps
      echo "‚úÖ Entorno completado correctamente."

    startCommand: gunicorn -k uvicorn.workers.UvicornWorker main:app --timeout 120 --log-level info

    healthCheckPath: /health

    envVars:
      # -------------------------------
      # üîê Variables de seguridad
      # -------------------------------
      - key: X_API_KEY
        value: HYGABOGADOS-SECURE-2025

      # -------------------------------
      # ‚öôÔ∏è Configuraci√≥n FielWeb
      # -------------------------------
      - key: FIELWEB_USERNAME
        value: consultor@hygabogados.ec
      - key: FIELWEB_PASSWORD
        value: consultor@hygabogados.ec
      - key: FIELWEB_LOGIN_URL
        value: https://www.fielweb.com/Cuenta/Login.aspx

      # -------------------------------
      # üß† Configuraci√≥n t√©cnica
      # -------------------------------
      - key: PYTHON_VERSION
        value: 3.10.12
      - key: PLAYWRIGHT_BROWSERS_PATH
        value: /usr/local/share/playwright
      - key: NODE_OPTIONS
        value: --max-old-space-size=4096
      - key: LOG_LEVEL
        value: info

    # -------------------------------
    # üîç Pol√≠tica de reinicios autom√°ticos
    # -------------------------------
    autoDeploy: true
    retries: 3
    maxRetries: 5
    timeout: 600
